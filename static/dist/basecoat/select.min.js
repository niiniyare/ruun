"use strict";(()=>{(()=>{const x=s=>{const a=s.querySelector(":scope > button"),L=a.querySelector(":scope > span"),n=s.querySelector(":scope > [data-popover]"),l=n.querySelector('[role="listbox"]'),v=s.querySelector(':scope > input[type="hidden"]'),c=s.querySelector('header input[type="text"]');if(!a||!n||!l||!v){const e=[];a||e.push("trigger"),n||e.push("popover"),l||e.push("listbox"),v||e.push("input"),console.error(`Select component initialisation failed. Missing element(s): ${e.join(", ")}`,s);return}const h=Array.from(l.querySelectorAll('[role="option"]')),r=h.filter(e=>e.getAttribute("aria-disabled")!=="true");let d=[...r],o=-1;const f=e=>{if(o>-1&&r[o]&&r[o].classList.remove("active"),o=e,o>-1){const i=r[o];i.classList.add("active"),i.id?a.setAttribute("aria-activedescendant",i.id):a.removeAttribute("aria-activedescendant")}else a.removeAttribute("aria-activedescendant")},A=()=>{const e=getComputedStyle(n);return parseFloat(e.transitionDuration)>0||parseFloat(e.transitionDelay)>0},w=(e,i=!0)=>{if(e&&(L.innerHTML=e.innerHTML,v.value=e.dataset.value,l.querySelector('[role="option"][aria-selected="true"]')?.removeAttribute("aria-selected"),e.setAttribute("aria-selected","true"),i)){const t=new CustomEvent("change",{detail:{value:e.dataset.value},bubbles:!0});s.dispatchEvent(t)}},p=(e=!0)=>{if(n.getAttribute("aria-hidden")!=="true"){if(c){const i=()=>{c.value="",d=[...r],h.forEach(t=>t.setAttribute("aria-hidden","false"))};A()?n.addEventListener("transitionend",i,{once:!0}):i()}e&&a.focus(),n.setAttribute("aria-hidden","true"),a.setAttribute("aria-expanded","false"),f(-1)}},y=e=>{if(!e)return;const i=v.value,t=e.dataset.value;t!=null&&t!==i&&w(e),p()},O=e=>{const i=r.find(t=>t.dataset.value===e);y(i)};if(c){const e=()=>{const i=c.value.trim().toLowerCase();f(-1),d=[],h.forEach(t=>{if(t.hasAttribute("data-force")){t.setAttribute("aria-hidden","false"),r.includes(t)&&d.push(t);return}const u=(t.dataset.filter||t.textContent).trim().toLowerCase(),b=(t.dataset.keywords||"").toLowerCase(),k=u.includes(i)||b.includes(i);t.setAttribute("aria-hidden",String(!k)),k&&r.includes(t)&&d.push(t)})};c.addEventListener("input",e)}let E=r.find(e=>e.dataset.value===v.value);E||(E=r.find(e=>e.dataset.value!==void 0)??r[0]),w(E,!1);const g=e=>{const i=n.getAttribute("aria-hidden")==="false";if(!["ArrowDown","ArrowUp","Enter","Home","End","Escape"].includes(e.key))return;if(!i){e.key!=="Enter"&&e.key!=="Escape"&&(e.preventDefault(),a.click());return}if(e.preventDefault(),e.key==="Escape"){p();return}if(e.key==="Enter"){o>-1&&y(r[o]);return}if(d.length===0)return;const t=o>-1?d.indexOf(r[o]):-1;let u=t;switch(e.key){case"ArrowDown":t<d.length-1&&(u=t+1);break;case"ArrowUp":t>0?u=t-1:t===-1&&(u=0);break;case"Home":u=0;break;case"End":u=d.length-1;break}if(u!==t){const b=d[u];f(r.indexOf(b)),b.scrollIntoView({block:"nearest",behavior:"smooth"})}};l.addEventListener("mousemove",e=>{const i=e.target.closest('[role="option"]');if(i&&d.includes(i)){const t=r.indexOf(i);t!==o&&f(t)}}),l.addEventListener("mouseleave",()=>{const e=l.querySelector('[role="option"][aria-selected="true"]');f(e?r.indexOf(e):-1)}),a.addEventListener("keydown",g),c&&c.addEventListener("keydown",g);const m=()=>{document.dispatchEvent(new CustomEvent("basecoat:popover",{detail:{source:s}})),c&&(A()?n.addEventListener("transitionend",()=>{c.focus()},{once:!0}):c.focus()),n.setAttribute("aria-hidden","false"),a.setAttribute("aria-expanded","true");const e=l.querySelector('[role="option"][aria-selected="true"]');e&&(f(r.indexOf(e)),e.scrollIntoView({block:"nearest"}))};a.addEventListener("click",()=>{a.getAttribute("aria-expanded")==="true"?p():m()}),l.addEventListener("click",e=>{const i=e.target.closest('[role="option"]');i&&y(i)}),document.addEventListener("click",e=>{s.contains(e.target)||p(!1)}),document.addEventListener("basecoat:popover",e=>{e.detail.source!==s&&p(!1)}),n.setAttribute("aria-hidden","true"),s.selectByValue=O,s.dataset.selectInitialized=!0,s.dispatchEvent(new CustomEvent("basecoat:initialized"))};window.basecoat&&window.basecoat.register("select","div.select:not([data-select-initialized])",x)})();})();
