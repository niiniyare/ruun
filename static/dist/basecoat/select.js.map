{
  "version": 3,
  "sources": ["../../js/basecoat/select.js"],
  "sourcesContent": ["(() => {\n  const initSelect = (selectComponent) => {\n    const trigger = selectComponent.querySelector(':scope > button');\n    const selectedLabel = trigger.querySelector(':scope > span');\n    const popover = selectComponent.querySelector(':scope > [data-popover]');\n    const listbox = popover.querySelector('[role=\"listbox\"]');\n    const input = selectComponent.querySelector(':scope > input[type=\"hidden\"]');\n    const filter = selectComponent.querySelector('header input[type=\"text\"]');\n    if (!trigger || !popover || !listbox || !input) {\n      const missing = [];\n      if (!trigger) missing.push('trigger');\n      if (!popover) missing.push('popover');\n      if (!listbox) missing.push('listbox');\n      if (!input)   missing.push('input');\n      console.error(`Select component initialisation failed. Missing element(s): ${missing.join(', ')}`, selectComponent);\n      return;\n    }\n    \n    const allOptions = Array.from(listbox.querySelectorAll('[role=\"option\"]'));\n    const options = allOptions.filter(opt => opt.getAttribute('aria-disabled') !== 'true');\n    let visibleOptions = [...options];\n    let activeIndex = -1;\n\n    const setActiveOption = (index) => {\n      if (activeIndex > -1 && options[activeIndex]) {\n        options[activeIndex].classList.remove('active');\n      }\n      \n      activeIndex = index;\n      \n      if (activeIndex > -1) {\n        const activeOption = options[activeIndex];\n        activeOption.classList.add('active');\n        if (activeOption.id) {\n          trigger.setAttribute('aria-activedescendant', activeOption.id);\n        } else {\n          trigger.removeAttribute('aria-activedescendant');\n        }\n      } else {\n        trigger.removeAttribute('aria-activedescendant');\n      }\n    };\n\n    const hasTransition = () => {\n      const style = getComputedStyle(popover);\n      return parseFloat(style.transitionDuration) > 0 || parseFloat(style.transitionDelay) > 0;\n    };\n\n    const updateValue = (option, triggerEvent = true) => {\n      if (option) {\n        selectedLabel.innerHTML = option.innerHTML;\n        input.value = option.dataset.value;\n        listbox.querySelector('[role=\"option\"][aria-selected=\"true\"]')?.removeAttribute('aria-selected');\n        option.setAttribute('aria-selected', 'true');\n        \n        if (triggerEvent) {\n          const event = new CustomEvent('change', {\n            detail: { value: option.dataset.value },\n            bubbles: true\n          });\n          selectComponent.dispatchEvent(event);\n        }\n      }\n    };\n\n    const closePopover = (focusOnTrigger = true) => {\n      if (popover.getAttribute('aria-hidden') === 'true') return;\n      \n      if (filter) {\n        const resetFilter = () => {\n          filter.value = '';\n          visibleOptions = [...options];\n          allOptions.forEach(opt => opt.setAttribute('aria-hidden', 'false'));\n        };\n        \n        if (hasTransition()) {\n          popover.addEventListener('transitionend', resetFilter, { once: true });\n        } else {\n          resetFilter();\n        }\n      }\n      \n      if (focusOnTrigger) trigger.focus();\n      popover.setAttribute('aria-hidden', 'true');\n      trigger.setAttribute('aria-expanded', 'false');\n      setActiveOption(-1);\n    }\n\n    const selectOption = (option) => {\n      if (!option) return;\n      \n      const oldValue = input.value;\n      const newValue = option.dataset.value;\n\n      if (newValue != null && newValue !== oldValue) {\n        updateValue(option);\n      }\n      \n      closePopover();\n    };\n\n    const selectByValue = (value) => {\n      const option = options.find(opt => opt.dataset.value === value);\n      selectOption(option);\n    };\n\n    if (filter) {\n      const filterOptions = () => {\n        const searchTerm = filter.value.trim().toLowerCase();\n        \n        setActiveOption(-1);\n\n        visibleOptions = [];\n        allOptions.forEach(option => {\n          if (option.hasAttribute('data-force')) {\n            option.setAttribute('aria-hidden', 'false');\n            if (options.includes(option)) {\n              visibleOptions.push(option);\n            }\n            return;\n          }\n\n          const optionText = (option.dataset.filter || option.textContent).trim().toLowerCase();\n          const keywords = (option.dataset.keywords || '').toLowerCase();\n          const matches = optionText.includes(searchTerm) || keywords.includes(searchTerm);\n          option.setAttribute('aria-hidden', String(!matches));\n          if (matches && options.includes(option)) {\n            visibleOptions.push(option);\n          }\n        });\n      };\n  \n      filter.addEventListener('input', filterOptions);\n    }\n\n    let initialOption = options.find(opt => opt.dataset.value === input.value);\n    \n    if (!initialOption) {\n      initialOption = options.find(opt => opt.dataset.value !== undefined) ?? options[0];\n    }\n\n    updateValue(initialOption, false);\n\n    const handleKeyNavigation = (event) => {\n      const isPopoverOpen = popover.getAttribute('aria-hidden') === 'false';\n\n      if (!['ArrowDown', 'ArrowUp', 'Enter', 'Home', 'End', 'Escape'].includes(event.key)) {\n        return;\n      }\n\n      if (!isPopoverOpen) {\n        if (event.key !== 'Enter' && event.key !== 'Escape') {\n          event.preventDefault();\n          trigger.click();\n        }\n        return;\n      }\n      \n      event.preventDefault();\n\n      if (event.key === 'Escape') {\n        closePopover();\n        return;\n      }\n      \n      if (event.key === 'Enter') {\n        if (activeIndex > -1) {\n          selectOption(options[activeIndex]);\n        }\n        return;\n      }\n\n      if (visibleOptions.length === 0) return;\n\n      const currentVisibleIndex = activeIndex > -1 ? visibleOptions.indexOf(options[activeIndex]) : -1;\n      let nextVisibleIndex = currentVisibleIndex;\n\n      switch (event.key) {\n        case 'ArrowDown':\n          if (currentVisibleIndex < visibleOptions.length - 1) {\n            nextVisibleIndex = currentVisibleIndex + 1;\n          }\n          break;\n        case 'ArrowUp':\n          if (currentVisibleIndex > 0) {\n            nextVisibleIndex = currentVisibleIndex - 1;\n          } else if (currentVisibleIndex === -1) {\n            nextVisibleIndex = 0;\n          }\n          break;\n        case 'Home':\n          nextVisibleIndex = 0;\n          break;\n        case 'End':\n          nextVisibleIndex = visibleOptions.length - 1;\n          break;\n      }\n\n      if (nextVisibleIndex !== currentVisibleIndex) {\n        const newActiveOption = visibleOptions[nextVisibleIndex];\n        setActiveOption(options.indexOf(newActiveOption));\n        newActiveOption.scrollIntoView({ block: 'nearest', behavior: 'smooth' });\n      }\n    };\n\n    listbox.addEventListener('mousemove', (event) => {\n      const option = event.target.closest('[role=\"option\"]');\n      if (option && visibleOptions.includes(option)) {\n        const index = options.indexOf(option);\n        if (index !== activeIndex) {\n          setActiveOption(index);\n        }\n      }\n    });\n\n    listbox.addEventListener('mouseleave', () => {\n      const selectedOption = listbox.querySelector('[role=\"option\"][aria-selected=\"true\"]');\n      if (selectedOption) {\n        setActiveOption(options.indexOf(selectedOption));\n      } else {\n        setActiveOption(-1);\n      }\n    });\n\n    trigger.addEventListener('keydown', handleKeyNavigation);\n    if (filter) {\n      filter.addEventListener('keydown', handleKeyNavigation);\n    }\n\n    const openPopover = () => {\n      document.dispatchEvent(new CustomEvent('basecoat:popover', {\n        detail: { source: selectComponent }\n      }));\n      \n      if (filter) {\n        if (hasTransition()) {\n          popover.addEventListener('transitionend', () => {\n            filter.focus();\n          }, { once: true });\n        } else {\n          filter.focus();\n        }\n      }\n\n      popover.setAttribute('aria-hidden', 'false');\n      trigger.setAttribute('aria-expanded', 'true');\n      \n      const selectedOption = listbox.querySelector('[role=\"option\"][aria-selected=\"true\"]');\n      if (selectedOption) {\n        setActiveOption(options.indexOf(selectedOption));\n        selectedOption.scrollIntoView({ block: 'nearest' });\n      }\n    };\n\n    trigger.addEventListener('click', () => {\n      const isExpanded = trigger.getAttribute('aria-expanded') === 'true';\n      if (isExpanded) {\n        closePopover();\n      } else {\n        openPopover();\n      }\n    });\n\n    listbox.addEventListener('click', (event) => {\n      const clickedOption = event.target.closest('[role=\"option\"]');\n      if (clickedOption) {\n        selectOption(clickedOption);\n      }\n    });\n\n    document.addEventListener('click', (event) => {\n      if (!selectComponent.contains(event.target)) {\n        closePopover(false);\n      }\n    });\n\n    document.addEventListener('basecoat:popover', (event) => {\n      if (event.detail.source !== selectComponent) {\n        closePopover(false);\n      }\n    });\n\n    popover.setAttribute('aria-hidden', 'true');\n    \n    selectComponent.selectByValue = selectByValue;\n    selectComponent.dataset.selectInitialized = true;\n    selectComponent.dispatchEvent(new CustomEvent('basecoat:initialized'));\n  };\n\n  if (window.basecoat) {\n    window.basecoat.register('select', 'div.select:not([data-select-initialized])', initSelect);\n  }\n})();"],
  "mappings": "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",
  "names": []
}
