================
CODE SNIPPETS
================
### Install Datastar by Self-Hosting

Source: https://data-star.dev/guide/getting_started

Includes Datastar by referencing a locally hosted script file. This method is useful if you prefer to manage your own dependencies or have specific build processes. The path to the script needs to be correctly specified.

```html
<script type="module" src="/path/to/datastar.js"></script>
```

--------------------------------

### Install Datastar using CDN

Source: https://data-star.dev/guide/getting_started

Includes Datastar using a script tag from a CDN. This is the quickest method for integrating Datastar into your project. No specific inputs or outputs are mentioned, but it requires an internet connection to the CDN.

```html
<script type="module" src="https://cdn.jsdelivr.net/gh/starfederation/datastar@1.0.0-RC.5/bundles/datastar.js"></script>
```

--------------------------------

### Send GET Request with Datastar Action

Source: https://data-star.dev/guide/getting_started

This snippet shows how to use the `@get()` action in Datastar to send a GET request to a specified URL when a button is clicked. The response from the backend can then be used to update the DOM.

```html
<button data-on-click="@get('/endpoint')">
    Open the pod bay doors, HAL.
</button>
<div id="hal"></div>
```

--------------------------------

### Patch DOM Elements with C# SDK

Source: https://data-star.dev/guide/getting_started

This example shows how to use the Datastar C# SDK to patch elements into the DOM. It demonstrates asynchronously updating content within a specific HTML element after a short delay.

```csharp
using StarFederation.Datastar.DependencyInjection;

// Adds Datastar as a service
builder.Services.AddDatastar();

app.MapGet("/", async (IDatastarService datastarService) =>
{
    // Patches elements into the DOM.
    await datastarService.PatchElementsAsync(@"<div id=\"hal\">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>");

    await Task.Delay(TimeSpan.FromSeconds(1));

    await datastarService.PatchElementsAsync(@"<div id=\"hal\">Waiting for an order...</div>");
});
```

--------------------------------

### Patching Signals with SSE (Go)

Source: https://data-star.dev/docs

Provides an example of patching signals using SSE in Go. It utilizes the `datastar-go` library to create a `ServerSentEventGenerator` and send patch signals.

```go
1import (
2    "github.com/starfederation/datastar-go/datastar"
3)
4
5// Creates a new `ServerSentEventGenerator` instance.
6sse := datastar.NewSSE(w, r)
7
8// Patches signals
9sse.PatchSignals([]byte(`{hal: 'Affirmative, Dave. I read you.'}`))
10
time.Sleep(1 * time.Second)
11
12sse.PatchSignals([]byte(`{hal: '...'}`))
```

--------------------------------

### Sequential DOM Patching with SSE

Source: https://data-star.dev/guide

Shows how to send multiple `datastar-patch-elements` SSE events sequentially to update an element, first with one message and then with another after a delay. This demonstrates dynamic content updates.

```sse
event: datastar-patch-elements
data: elements <div id="hal">
    I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.
</div>

event: datastar-patch-elements
data: elements <div id="hal">
    Waiting for an order...
</div>
```

--------------------------------

### Patch Elements using SSE with Kotlin SDK

Source: https://data-star.dev/guide

Presents a Kotlin example for patching elements into the DOM using Datastar. It utilizes the `ServerSentEventGenerator` and its `patchElements` function to send HTML content for DOM manipulation, including delayed updates.

```kotlin
val generator = ServerSentEventGenerator(response)

generator.patchElements(
    elements = """<div id=\"hal\">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>""",
)

Thread.sleep(ONE_SECOND)

generator.patchElements(

```

--------------------------------

### Patch Elements using SSE with Clojure SDK

Source: https://data-star.dev/guide

Provides a Clojure example of generating Server-Sent Events (SSE) to patch elements into the DOM. It uses the Datastar Clojure SDK to send an initial response and then update it after a delay.

```clojure
;; Import the SDK's api and your adapter
(require
 '[starfederation.datastar.clojure.api :as d*]
 '[starfederation.datastar.clojure.adapter.http-kit :refer [->sse-response on-open]])

;; in a ring handler
(defn handler [request]
  ;; Create an SSE response
  (->sse-response request
                  {on-open
                   (fn [sse]
                     ;; Patches elements into the DOM
                     (d*/patch-elements! sse
                                         "<div id=\"hal\">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>")
                     (Thread/sleep 1000)

                     (d*/patch-elements! sse
                                         "<div id=\"hal\">Waiting for an order...</div>"))})
```

--------------------------------

### Patch DOM Elements with Kotlin SDK

Source: https://data-star.dev/guide/getting_started

This Kotlin snippet shows how to use the Datastar Kotlin SDK to patch elements into the DOM. It demonstrates sending an initial HTML fragment and then updating it after a one-second delay.

```kotlin
val generator = ServerSentEventGenerator(response)

generator.patchElements(
    elements = """<div id="hal">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>""",
)

Thread.sleep(ONE_SECOND)

generator.patchElements(

```

--------------------------------

### Data Binding and Event Handling with data-star.dev

Source: https://data-star.dev/guide/backend_requests

This example demonstrates data binding for signals and computed properties, and event handling using data-on-click. The @get() action triggers a GET request to a specified endpoint when a button is clicked, driving state from the backend.

```html
<div
    data-signals="{response: '', answer: ''}"
    data-computed-correct="$response.toLowerCase() == $answer"
>
    <div id="question"></div>
    <button data-on-click="@get('/actions/quiz')">Fetch a question</button>
    <button
        data-show="$answer != ''"
        data-on-click="$response = prompt('Answer:') ?? ''"
    >
        BUZZ
    </button>
    <div data-show="$response != ''">
        You answered ‚Äú<span data-text="$response"></span>‚Äù.
        <span data-show="$correct">That is correct ‚úÖ</span>
        <span data-show="!$correct">
        The correct answer is ‚Äú<span data-text="$answer"></span>‚Äù ü§∑
        </span>
    </div>
</div>
```

--------------------------------

### C# DataStar ExecuteScriptAsync and PatchElementsAsync

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This C# example illustrates how to use `PatchElementsAsync` and `ExecuteScriptAsync` from the DataStar library for server-initiated redirects. It includes a `Task.Delay` to simulate a waiting period before the redirection.

```csharp
using StarFederation.Datastar.DependencyInjection;

app.MapGet("/redirect", async (IDatastarService datastarService) =>
{
    await datastarService.PatchElementsAsync("<div id=\"indicator\">Redirecting in 3 seconds...</div>");
    await Task.Delay(TimeSpan.FromSeconds(3));
    await datastarService.ExecuteScriptAsync("window.location = \"/guide\";");
});
```

--------------------------------

### Patching Signals with SSE (Ruby)

Source: https://data-star.dev/docs

Demonstrates patching signals using SSE in Ruby. This example uses the `Datastar` gem to create a streaming response and send patch signals with a sleep interval.

```ruby
1require 'datastar'
2
3# Create a Datastar::Dispatcher instance
4
datastar = Datastar.new(request:, response:)
5
6# In a Rack handler, you can instantiate from the Rack env
7# datastar = Datastar.from_rack_env(env)
8
9# Start a streaming response
10datastar.stream do |sse|
11  # Patches signals
12  sse.patch_signals(hal: 'Affirmative, Dave. I read you.')
13
14  sleep 1
15  
16  sse.patch_signals(hal: '...')
17end
```

--------------------------------

### Patch DOM Elements with Java SDK

Source: https://data-star.dev/guide/getting_started

This Java code demonstrates patching HTML elements into the DOM using the Datastar Java SDK. It sends an initial HTML response and then updates the content after a 1-second delay.

```java
import starfederation.datastar.utils.ServerSentEventGenerator;

// Creates a new `ServerSentEventGenerator` instance.
AbstractResponseAdapter responseAdapter = new HttpServletResponseAdapter(response);
ServerSentEventGenerator generator = new ServerSentEventGenerator(responseAdapter);

// Patches elements into the DOM.
generator.send(PatchElements.builder()
    .data("<div id=\"hal\">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>")
    .build()
);

Thread.sleep(1000);

generator.send(PatchElements.builder()
    .data("<div id=\"hal\">Waiting for an order...</div>")
    .build()
);
```

--------------------------------

### Backend GET Request

Source: https://data-star.dev/docs

Sends a GET request to the specified backend URI. Supports options for signal filtering, connection behavior, and content type.

```APIDOC
## @get()

### Description
Sends a `GET` request to the backend using the Fetch API. The URI can be any valid endpoint and the response must contain zero or more Datastar SSE events. Signals can be sent as query parameters. Options allow for custom signal filtering, keeping connections open when the page is hidden, and specifying content type.

### Method
GET

### Endpoint
`/uri` (string)

### Parameters
#### Path Parameters
None

#### Query Parameters
None

#### Request Body
Not applicable for GET requests. Signals are sent as query parameters by default.

### Request Example
```html
<button data-on-click="@get('/endpoint')"></button>
<button data-on-click="@get('/endpoint', {openWhenHidden: true})"></button>
<button data-on-click="@get('/endpoint', {contentType: 'form'}) "></button>

<!-- Example with file upload -->
<form enctype="multipart/form-data">
    <input type="file" name="file" />
    <button data-on-click="@get('/endpoint', {contentType: 'form'}) "></button>
</form>
```

### Response
#### Success Response (200)
- **SSE Events**: Zero or more Server-Sent Events.

#### Response Example
(Depends on the backend endpoint. Typically involves SSE stream.)
```

--------------------------------

### Patch DOM Elements with Go SDK

Source: https://data-star.dev/guide/getting_started

This snippet illustrates using the Datastar Go SDK to patch HTML elements into the DOM via Server-Sent Events (SSE). It sends an initial HTML fragment and then updates it after a one-second delay.

```go
import (
    "github.com/starfederation/datastar-go/datastar"
    time
)

// Creates a new `ServerSentEventGenerator` instance.
sse := datastar.NewSSE(w,r)

// Patches elements into the DOM.
sse.PatchElements(
    `<div id="hal">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>`
)

time.Sleep(1 * time.Second)

sse.PatchElements(
    `<div id="hal">Waiting for an order...</div>`
)
```

--------------------------------

### Kotlin DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Kotlin example demonstrates using the `ServerSentEventGenerator` to patch elements and execute a script for redirection, including a 3-second delay.

```kotlin
val generator = ServerSentEventGenerator(response)

generator.patchElements(
    elements =
        """
        <div id="indicator">Redirecting in 3 seconds...</div>
        """.trimIndent()
)

Thread.sleep(3 * ONE_SECOND)

generator.executeScript(
    script = "window.location.href = '/success'",
)
```

--------------------------------

### HTML Button for DataStar Redirect

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This snippet shows how to add a `data-on-click` attribute to an HTML button, which triggers a GET request to a specified backend endpoint when clicked. It also includes a placeholder `div` for visual feedback during the redirection process.

```html
<button data-on-click="@get('/endpoint')">
    Click to be redirected from the backend
</button>
<div id="indicator"></div>
```

--------------------------------

### GET /actions/quiz

Source: https://data-star.dev/docs

Triggers a GET request to the /actions/quiz endpoint when a button is clicked, fetching data and updating signals.

```APIDOC
## GET /actions/quiz

### Description
This endpoint is triggered by a `data-on-click` attribute. It sends a GET request to the server to fetch quiz data, which may update DOM elements and frontend signals.

### Method
GET

### Endpoint
/actions/quiz

### Parameters
#### Path Parameters
None

#### Query Parameters
None

#### Request Body
None

### Request Example
```html
<button data-on-click="@get('/actions/quiz')">Fetch a question</button>
```

### Response
#### Success Response (200)
- The server response may contain events to modify DOM elements (e.g., the 'question' element) and update frontend signals (e.g., 'response' and 'answer').

#### Response Example
(Server-side generated events that trigger client-side patching)
```

--------------------------------

### Python Redirect with DataStar-py

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Implements a redirect in Python using the datastar_py library. This asynchronous example yields SSE events for patching elements, sleeping, and executing a redirect script.

```python
from datastar_py import ServerSentEventGenerator as SSE
from datastar_py.sanic import datastar_response

@app.get("/redirect")
@datastar_response
async def redirect_from_backend():
    yield SSE.patch_elements('<div id="indicator">Redirecting in 3 seconds...</div>')
    await asyncio.sleep(3)
    yield SSE.execute_script('setTimeout(() => window.location = "/guide")')

```

--------------------------------

### Server-Sent Events for DataStar Redirect (SSE)

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This SSE example demonstrates how a backend can initiate a redirect. It first sends a `datastar-patch-elements` event to update an indicator, then waits for 3 seconds, and finally sends another SSE event to append a script that redirects the user.

```sse
event: datastar-patch-elements
data: elements <div id="indicator">Redirecting in 3 seconds...</div>

// Wait 3 seconds

event: datastar-patch-elements
selector body
mode append
data: elements <script>window.location.href = "/guide"</script>
```

--------------------------------

### C# SDK Example for Dynamic List Loading

Source: https://data-star.dev/how_tos/load_more_list_items

This C# example uses ASP.NET Core and the DataStar SDK to implement dynamic list loading. It defines a signal record, reads the offset signal, and then uses the IDatastarService to patch elements into the list, update signals, or remove the load-more button.

```csharp
 1using System.Text.Json;
 2using StarFederation.Datastar;
 3using StarFederation.Datastar.DependencyInjection;
 4
 5public class Program
 6{
 7    public record OffsetSignals(int offset);
 8
 9    public static void Main(string[] args)
10    {
11        var builder = WebApplication.CreateBuilder(args);
12        builder.Services.AddDatastar();
13        var app = builder.Build();
14
15        app.MapGet("/more", async (IDatastarService datastarService) =>
16        {
17            var max = 5;
18            var limit = 1;
19            var signals = await datastarService.ReadSignalsAsync<OffsetSignals>();
20            var offset = signals.offset;
21            if (offset < max)
22            {
23                var newOffset = offset + limit;
24                await datastarService.PatchElementsAsync($"<div>Item {newOffset}</div>", new()
25                {
26                    Selector = "#list",
27                    PatchMode = PatchElementsMode.Append,
28                });
29                if (newOffset < max)
30                    await datastarService.PatchSignalsAsync(new OffsetSignals(newOffset));
31                else
32                    await datastarService.RemoveElementAsync("#load-more");
33            }
34        });
35
36        app.Run();
37    }
38}

```

--------------------------------

### Stream SSE Events with Ruby using Datastar

Source: https://data-star.dev/docs

This Ruby example shows how to stream Server-Sent Events (SSE) using the Datastar gem. It initializes a `Datastar` instance and uses its `stream` method to send patches for DOM elements and signals.

```ruby
1require 'datastar'
 2
 3# Create a Datastar::Dispatcher instance
 4
 5datastar = Datastar.new(request:, response:)
 6
 7# In a Rack handler, you can instantiate from the Rack env
 8# datastar = Datastar.from_rack_env(env)
 9
10# Start a streaming response
11datastar.stream do |sse|
12  # Patches elements into the DOM
13  sse.patch_elements %(<div id="question">What do you put in a toaster?</div>)
14
15  # Patches signals
16  sse.patch_signals(response: '', answer: 'bread')
17end
```

--------------------------------

### DataStar Control Request Cancellation

Source: https://data-star.dev/docs

Shows how to control DataStar's request cancellation behavior. The first example disables automatic cancellation, allowing concurrent requests. The second example demonstrates using a custom AbortController for fine-grained control over starting and cancelling requests.

```html
<!-- Allow concurrent requests (no automatic cancellation) -->
<button data-on-click="@get('/endpoint', {requestCancellation: 'disabled'}) k·ª∑ ">Allow Multiple</button>

<!-- Custom abort controller for fine-grained control -->
<div data-signals-controller="new AbortController()">
    <button data-on-click="@get('/endpoint', {requestCancellation: $controller}) k·ª∑ ">Start Request</button>
    <button data-on-click="$controller.abort()">Cancel Request</button>
</div>
```

--------------------------------

### Go Redirect with Server-Sent Events (SSE)

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Handles redirects in Go using Server-Sent Events (SSE) by patching elements, sleeping for a duration, and then redirecting the client. This example uses the datastar-go library.

```go
import (
    "time"
    "github.com/starfederation/datastar-go/datastar"
)

sse := datastar.NewSSE(w, r)
sse.PatchElements(`
    <div id="indicator">Redirecting in 3 seconds...</div>
`)
time.Sleep(3 * time.Second)
sse.ExecuteScript(`
    setTimeout(() => window.location = "/guide")
`)

```

```go
import (
    "time"
    "github.com/starfederation/datastar-go/datastar"
)

sse := datastar.NewSSE(w, r)
sse.PatchElements(`
    <div id="indicator">Redirecting in 3 seconds...</div>
`)
time.Sleep(3 * time.Second)
sse.Redirect("/guide")

```

--------------------------------

### Activate Users

Source: https://data-star.dev/examples/bulk_update

Activates selected users.

```APIDOC
## PUT /examples/bulk_update/activate

### Description
Activates the selected users. The server will then re-render the table with updated rows.

### Method
PUT

### Endpoint
`/examples/bulk_update/activate`

### Parameters
#### Query Parameters
- **selections** (Array<Boolean>) - Required - An array indicating which users to activate.

### Request Body
This endpoint does not require a request body. Selections are passed as query parameters.

### Response
#### Success Response (200)
- **table** (String) - The re-rendered HTML table with updated user statuses.

#### Response Example
```html
<table>...</table>
```
```

--------------------------------

### Practical Use Case: Menu State Toggle with Nested Signals

Source: https://data-star.dev/docs

A practical example demonstrating the use of nested signals to manage the open/closed state of menus for desktop and mobile devices. It includes an action to toggle all menu states at once.

```html
<div data-signals="{menu: {isOpen: {desktop: false, mobile: false}}}">
    <button data-on-click="@toggleAll({include: /^menu\.isOpen\./})">
        Open/close menu
    </button>
</div>
```

--------------------------------

### Clojure Redirect with DataStar API

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Demonstrates a redirect in Clojure using the DataStar API. It sets up an SSE response that patches elements, pauses for 3 seconds, and then redirects the client.

```clojure
(require
  '[starfederation.datastar.clojure.api :as d*]
  '[starfederation.datastar.clojure.adapter.http-kit :refer [->sse-response on-open]]
  '[some.hiccup.library :refer [html]])


(defn handler [ring-request]
  (->sse-response ring-request
    {on-open
      (fn [sse]
        (d*/patch-elements! sse
          (html [:div#indicator "Redirecting in 3 seconds..."]))
        (Thread/sleep 3000)
        (d*/redirect! sse "/guide")
        (d*/close-sse! sse))}))

```

--------------------------------

### Node.js DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Node.js example demonstrates using the `ServerSentEventGenerator` to stream SSE events for patching elements and executing a script to redirect the user after a 3-second delay using `setTimeout`.

```javascript
import { createServer } from "node:http";
import { ServerSentEventGenerator } from "../npm/esm/node/serverSentEventGenerator.js";

const server = createServer(async (req, res) => {

  ServerSentEventGenerator.stream(req, res, async (sse) => {
    sse.patchElements(`
      <div id="indicator">Redirecting in 3 seconds...</div>
    `);

    setTimeout(() => {
      sse.executeScript(`window.location = "/guide"`);
    }, 3000);
  });
});
```

--------------------------------

### Rust DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Rust example utilizes DataStar's SSE capabilities to patch elements and execute a script for redirection, incorporating a Tokio-based delay.

```rust
use datastar::prelude::*;
use async_stream::stream;
use core::time::Duration;

Sse(stream! {
    yield PatchElements::new("<div id='indicator'>Redirecting in 3 seconds...</div>").into();
    tokio::time::sleep(core::time::Duration::from_secs(3)).await;
    yield ExecuteScript::new("window.location = '/guide'").into();
});
```

--------------------------------

### Patching Signals with SSE (PHP)

Source: https://data-star.dev/docs

Shows how to patch signals using SSE in PHP. This example utilizes the `ServerSentEventGenerator` to send signal updates with a sleep interval.

```php
1use starfederation\datastar\ServerSentEventGenerator;
2
3// Creates a new `ServerSentEventGenerator` instance.
4$sse = new ServerSentEventGenerator();
5
6// Patches signals.
7$sse->patchSignals(['hal' => 'Affirmative, Dave. I read you.']);
8
sleep(1)
10
11$sse->patchSignals(['hal' => '...']);
```

--------------------------------

### Patch HTML Elements via SSE

Source: https://data-star.dev/guide/getting_started

Demonstrates how to send Server-Sent Events (SSE) with the `datastar-patch-elements` event type to update specific HTML elements in the DOM. This allows for dynamic content changes on the frontend.

```html
event: datastar-patch-elements
data: elements <div id="hal">
    I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.
</div>
```

--------------------------------

### Stream SSE Events with PHP using Datastar

Source: https://data-star.dev/docs

This PHP example shows how to stream Server-Sent Events (SSE) using the Datastar SDK. It creates a `ServerSentEventGenerator` instance and then calls methods to patch elements and signals.

```php
1use starfederation\datastar\ServerSentEventGenerator;
 2
 3// Creates a new `ServerSentEventGenerator` instance.
 4$sse = new ServerSentEventGenerator();
 5
 6// Patches elements into the DOM.
 7$sse->patchElements(
 8    '<div id="question">What do you put in a toaster?</div>'
 9);
10
11// Patches signals.
12$sse->patchSignals(['response' => '', 'answer' => 'bread']);
```

--------------------------------

### Clojure SDK Example for Dynamic List Loading

Source: https://data-star.dev/how_tos/load_more_list_items

This Clojure code demonstrates how to handle requests and send DataStar events using the SDK. It reads signals to get the current offset, patches new elements to the list in append mode, and either patches new signals or removes the load-more button based on the offset.

```clojure
 1(require
 2  '[starfederation.datastar.clojure.api :as d*]
 3  '[starfederation.datastar.clojure.adapter.http-kit :refer [->sse-response on-open]]
 4  '[some.hiccup.library :refer [html]]
 5  '[some.json.library :refer [read-json-str write-json-str]]))
 6
 7
 8(def max-offset 5)
 9
10(defn handler [ring-request]
11  (->sse-response ring-request
12    {on-open
13     (fn [sse]
14       (let [d*-signals (-> ring-request d*/get-signals read-json-str)
15             offset (get d*-signals "offset")
16             limit 1
17             new-offset (+ offset limit)]
18
19         (d*/patch-elements! sse
20                             (html [:div "Item " new-offset])
21                             {d*/selector   "#list"
22                              d*/merge-mode d*/mm-append})
23
24         (if (< new-offset max-offset)
25           (d*/patch-signals! sse (write-json-str {"offset" new-offset}))
26           (d*/remove-fragment! sse "#load-more"))
27
28         (d*/close-sse! sse)))}))

```

--------------------------------

### Backend PATCH Request

Source: https://data-star.dev/docs

Sends a PATCH request to the specified backend URI, offering the same configuration options as `@get()` for signals and connections.

```APIDOC
## @patch()

### Description
Sends a `PATCH` request to the backend. Similar to `@get()`, this method uses the PATCH HTTP method and accepts the same options for signal filtering, background connection management, and content type. Signals are sent as a JSON body by default.

### Method
PATCH

### Endpoint
`/uri` (string)

### Parameters
#### Path Parameters
None

#### Query Parameters
None

#### Request Body
- **Datastar Signals**: By default, an object containing Datastar signals (excluding those starting with `_`) is sent as the JSON request body.

### Request Example
```html
<button data-on-click="@patch('/endpoint')"></button>
```

### Response
#### Success Response (200)
- **SSE Events**: Zero or more Server-Sent Events.

#### Response Example
(Depends on the backend endpoint. Typically involves SSE stream.)
```

--------------------------------

### Send GET Request with @get()

Source: https://data-star.dev/docs

The @get() method sends a GET request to a specified backend URI using the Fetch API. Responses must contain Datastar SSE events. By default, it includes a 'Datastar-Request' header and signal data, configurable via 'filterSignals'. Supports 'openWhenHidden' and 'contentType' options.

```HTML
<button data-on-click="@get('/endpoint')"></button>
<button data-on-click="@get('/endpoint', {openWhenHidden: true})"></button>
<button data-on-click="@get('/endpoint', {contentType: 'form'})></button>

<form enctype="multipart/form-data">
    <input type="file" name="file" />
    <button data-on-click="@get('/endpoint', {contentType: 'form'})></button>
</form>
```

--------------------------------

### Rust Redirect with DataStar Prelude

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Shows a redirect implementation in Rust using the datastar crate. It leverages async streams to send SSE events for patching elements, delaying, and executing a script for redirection.

```rust
use datastar::prelude::*;
use async_stream::stream;
use core::time::Duration;

Sse(stream! {
    yield PatchElements::new("<div id='indicator'>Redirecting in 3 seconds...</div>").into();
    tokio::time::sleep(core::time::Duration::from_secs(3)).await;
    yield ExecuteScript::new("setTimeout(() => window.location = '/guide')").into();
});

```

--------------------------------

### HTML Button for Click-to-Load

Source: https://data-star.dev/examples/click_to_load

This HTML snippet represents the button that initiates the 'click-to-load' functionality. It includes attributes for dynamic styling based on a fetching state and an event handler for the click action. The `data-on-click` attribute specifies the function to call, which in turn fetches more data.

```html
<button
    class="info wide"
    data-indicator-_fetching
    data-attr-aria-disabled="`${$_fetching}`"
    data-on-click="!$_fetching && @get('/examples/click_to_load/more')">
    Load More
</button>
```

--------------------------------

### Backend POST Request

Source: https://data-star.dev/docs

Sends a POST request to the specified backend URI. Similar to `@get()`, it supports options for signal handling and connection management.

```APIDOC
## @post()

### Description
Sends a `POST` request to the backend. This method functions similarly to `@get()` but utilizes the POST HTTP method. Signals are sent as a JSON body by default. It supports options for filtering signals, managing background connections, and setting content types.

### Method
POST

### Endpoint
`/uri` (string)

### Parameters
#### Path Parameters
None

#### Query Parameters
None

#### Request Body
- **Datastar Signals**: By default, an object containing Datastar signals (excluding those starting with `_`) is sent as the JSON request body.

### Request Example
```html
<button data-on-click="@post('/endpoint')"></button>
```

### Response
#### Success Response (200)
- **SSE Events**: Zero or more Server-Sent Events.

#### Response Example
(Depends on the backend endpoint. Typically involves SSE stream.)
```

--------------------------------

### Go DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Go snippet shows the implementation of DataStar's `ExecuteScript` and `PatchElements` methods using Server-Sent Events. It includes a 3-second sleep before executing the script for redirection.

```go
import (
    "time"
    "github.com/starfederation/datastar-go/datastar"
)

sse := datastar.NewSSE(w, r)
sse.PatchElements(`
    <div id="indicator">Redirecting in 3 seconds...</div>
`)
time.Sleep(3 * time.Second)
sse.ExecuteScript(`
    window.location = "/guide"
`)
```

--------------------------------

### Python DataStar ExecuteScript and PatchElements (Sanic)

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Python example uses DataStar with the Sanic framework to perform server-initiated redirects. It yields SSE events for patching elements and executing a script, with an asynchronous delay.

```python
from datastar_py import ServerSentEventGenerator as SSE
from datastar_py.sanic import datastar_response
import asyncio

@app.get("/redirect")
@datastar_response
async def redirect_from_backend():
    yield SSE.patch_elements('<div id="indicator">Redirecting in 3 seconds...</div>')
    await asyncio.sleep(3)
    yield SSE.execute_script('window.location = "/guide"')
```

--------------------------------

### Stream SSE Events with JavaScript (Node.js)

Source: https://data-star.dev/docs

This example shows how to stream Server-Sent Events (SSE) using Datastar in a Node.js environment. It utilizes the `ServerSentEventGenerator` to stream patched elements and signals.

```javascript
1// Creates a new `ServerSentEventGenerator` instance (this also sends required headers)
 2ServerSentEventGenerator.stream(req, res, (stream) => {
 3    // Patches elements into the DOM
 4    stream.patchElements('<div id="question">What do you put in a toaster?</div>');
 5
 6    // Patches signals
 7    stream.patchSignals({ response: '', answer: 'bread' });
 8});
```

--------------------------------

### Stream SSE Events with C# using Datastar

Source: https://data-star.dev/docs

This example shows how to use the Datastar SDK in C# to stream Server-Sent Events (SSE). It registers Datastar as a service and then uses `IDatastarService` to asynchronously patch elements into the DOM and send signals.

```csharp
1using StarFederation.Datastar.DependencyInjection;
 2
 3// Adds Datastar as a service
 4builder.Services.AddDatastar();
 5
 6app.MapGet("/", async (IDatastarService datastarService) =>
 7{
 8    // Patches elements into the DOM.
 9    await datastarService.PatchElementsAsync(@"<div id=\"question\">What do you put in a toaster?</div>");
10
11    // Patches signals.
12    await datastarService.PatchSignalsAsync(new { response = "", answer = "bread" });
13});
```

--------------------------------

### Submit Form Data using data-on-submit with ContentType 'form'

Source: https://data-star.dev/examples/form_data

This example shows how to initiate a GET request with contentType set to 'form' when a form is submitted. The @get() action is triggered by the 'data-on-submit' attribute on the form element, automatically sending the form's data.

```html
<form data-on-submit="@get('/endpoint', {contentType: 'form'})">
    foo: <input type="text" name="foo" required />
    <button>
        Submit form
    </button>
</form>
```

--------------------------------

### PHP Redirect with ServerSentEventGenerator

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Shows how to perform a redirect in PHP using the ServerSentEventGenerator class. This includes patching elements, a short sleep, and then executing the redirect script.

```php
use starfederation\datastar\ServerSentEventGenerator;

$sse = new ServerSentEventGenerator();
$sse->patchElements(`
    <div id="indicator">Redirecting in 3 seconds...</div>
`);
sleep(3);
$sse->executeScript(`
    setTimeout(() => window.location = "/guide")
`);

```

--------------------------------

### Stream SSE Events with Java using Datastar

Source: https://data-star.dev/docs

This Java example utilizes the Datastar SDK to stream Server-Sent Events (SSE). It creates a `ServerSentEventGenerator` and uses it to send patches for DOM elements and signals, adapting the response using `HttpServletResponseAdapter`.

```java
1import starfederation.datastar.utils.ServerSentEventGenerator;
 2
 3// Creates a new `ServerSentEventGenerator` instance.
 4AbstractResponseAdapter responseAdapter = new HttpServletResponseAdapter(response);
 5ServerSentEventGenerator generator = new ServerSentEventGenerator(responseAdapter);
 6
 7// Patches elements into the DOM.
 8generator.send(PatchElements.builder()
 9    .data("<div id=\"question\">What do you put in a toaster?</div>")
10    .build()
11);
12
13// Patches signals.
14generator.send(PatchSignals.builder()
15    .data("{\"response\": \"\", \"answer\": \"\"}")
16    .build()
17);
```

--------------------------------

### PHP DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This PHP snippet shows how to use the `ServerSentEventGenerator` to patch elements and execute a script for redirection, with a 3-second sleep in between.

```php
use starfederation\datastar\ServerSentEventGenerator;

$sse = new ServerSentEventGenerator();
$sse->patchElements(`
    <div id="indicator">Redirecting in 3 seconds...</div>
`);
sleep(3);
$sse->executeScript(`
    window.location = "/guide"
`);
```

--------------------------------

### Add Click Event Listener with data-on

Source: https://data-star.dev/guide/getting_started

Attaches a click event listener to an HTML button using the `data-on-click` attribute. When clicked, it executes a JavaScript expression that shows an alert. This demonstrates how to add frontend reactivity using standard HTML attributes.

```html
<button data-on-click="alert('I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.')">
    Open the pod bay doors, HAL.
</button>
```

--------------------------------

### Backend Redirect with Python Sanic Server-Sent Events

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Python example using the Sanic framework shows how to perform a backend redirect. It yields SSE events to patch an indicator and then initiate a redirect after a 3-second asynchronous sleep.

```python
from datastar_py import ServerSentEventGenerator as SSE
from datastar_py.sanic import datastar_response

@app.get("/redirect")
@datastar_response
async def redirect_from_backend():
    yield SSE.patch_elements('<div id="indicator">Redirecting in 3 seconds...</div>')
    await asyncio.sleep(3)
    yield SSE.redirect("/guide")
```

--------------------------------

### Go SDK Example for Dynamic List Loading

Source: https://data-star.dev/how_tos/load_more_list_items

This Go code demonstrates using the DataStar SDK to handle dynamic list loading. It reads offset signals, and then uses the SSE object to patch elements into the '#list' container with append mode, update signals, or remove the load-more button.

```go
 1import (
 2    "fmt"
 3    "net/http"
 4
 5    "github.com/go-chi/chi/v5"
 6    "github.com/starfederation/datastar-go/datastar"
 7)
 8
 9type OffsetSignals struct {
10    Offset int `json:"offset"`
11}
12
13signals := &OffsetSignals{}
14if err := datastar.ReadSignals(r, signals); err != nil {
15    http.Error(w, err.Error(), http.StatusBadRequest)
16}
17
18max := 5
19limit := 1
20offset := signals.Offset
21
22sse := datastar.NewSSE(w, r)
23
24if offset < max {
25    newOffset := offset + limit
26    sse.PatchElements(fmt.Sprintf(`<div>Item %d</div>`, newOffset),
27        datastar.WithSelectorID("list"),
28        datastar.WithModeAppend(),
29    )
30    if newOffset < max {
31        sse.PatchSignals([]byte(fmt.Sprintf(`{offset: %d}`, newOffset)))
32    } else {
33        sse.RemoveElements(`#load-more`)
34    }
35}

```

--------------------------------

### Kotlin Redirect with ServerSentEventGenerator

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

Demonstrates how to implement redirects in Kotlin using the ServerSentEventGenerator. It involves patching HTML elements, pausing execution, and then initiating a redirect.

```kotlin
val generator = ServerSentEventGenerator(response)

generator.patchElements(
    elements = 
        """
        <div id="indicator">Redirecting in 3 seconds...</div>
        """.trimIndent(),
)

Thread.sleep(3 * ONE_SECOND)

generator.executeScript(
    script = "setTimeout(() => window.location = '/guide')",
)

```

```kotlin
val generator = ServerSentEventGenerator(response)

generator.patchElements(
    elements = 
        """
        <div id="indicator">Redirecting in 3 seconds...</div>
        """.trimIndent(),
)

Thread.sleep(3 * ONE_SECOND)

generator.redirect("/guide")

```

--------------------------------

### HTML Structure for Progressive Loading

Source: https://data-star.dev/examples/progressive_load

This HTML snippet defines the main structure of a page designed for progressive loading. It includes a button to trigger the loading and placeholders for content sections like header, article, and comments, which are intended to be populated dynamically via SSE.

```html
<div>
    <div class="actions">
        <button
            id="load-button"
            data-signals-load-disabled="false"
            data-on-click="$loadDisabled=true; @get('/examples/progressive_load/updates')"
            data-attr-disabled="$loadDisabled"
            data-indicator-progressive-Load
        >
            Load
        </button>
        <!-- Indicator element -->
    </div>
    <p>
        Each part is loaded randomly and progressively.
    </p>
</div>
<div id="Load">
    <header id="header">Welcome to my blog</header>
    <section id="article">
        <h4>This is my article</h4>
        <section id="articleBody">
            <p>
                Lorem ipsum dolor sit amet...
            </p>
        </section>
    </section>
    <section id="comments">
        <h5>Comments</h5>
        <p>
            This is the comments section. It will also be progressively loaded as you scroll down.
        </p>
        <ul id="comments-list">
            <li id="1">
                <img src="https://avatar.iran.liara.run/username?username=example" alt="Avatar" class="avatar"/>
                This is a comment...
            </li>
            <!-- More comments loaded progressively -->
        </ul>
    </section>
    <div id="footer">Hope you like it</div>
</div>
```

--------------------------------

### Backend PUT Request

Source: https://data-star.dev/docs

Sends a PUT request to the specified backend URI, with similar options to `@get()` for signal management and connection behavior.

```APIDOC
## @put()

### Description
Sends a `PUT` request to the backend. This method is analogous to `@get()` but uses the PUT HTTP method. It supports the same options for signal filtering, background connection handling, and content type specification. Signals are sent as a JSON body by default.

### Method
PUT

### Endpoint
`/uri` (string)

### Parameters
#### Path Parameters
None

#### Query Parameters
None

#### Request Body
- **Datastar Signals**: By default, an object containing Datastar signals (excluding those starting with `_`) is sent as the JSON request body.

### Request Example
```html
<button data-on-click="@put('/endpoint')"></button>
```

### Response
#### Success Response (200)
- **SSE Events**: Zero or more Server-Sent Events.

#### Response Example
(Depends on the backend endpoint. Typically involves SSE stream.)
```

--------------------------------

### Clojure DataStar ExecuteScript and PatchElements

Source: https://data-star.dev/how_tos/redirect_the_page_from_the_backend

This Clojure snippet demonstrates using DataStar's `execute-script!` and `patch-elements!` functions within an SSE response. It includes a 3-second delay before executing the script for redirection.

```clojure
(require
  '[starfederation.datastar.clojure.api :as d*]
  '[starfederation.datastar.clojure.adapter.http-kit :refer [->sse-response on-open]]
  '[some.hiccup.library :refer [html]])


(defn handle [ring-request]
  (->sse-response ring-request
    {on-open
      (fn [sse]
        (d*/patch-elements! sse
          (html [:div#indicator "Redirecting in 3 seconds..."]))
        (Thread/sleep 3000)
        (d*/execute-script! sse "window.location = \"/guide\"")
        (d*/close-sse! sse)}))
```

--------------------------------

### Datastar Expression: Signal Property Access

Source: https://data-star.dev/docs

Shows how to access properties of a signal within a Datastar expression. This example displays the length of the `$foo` signal, assuming it's a string or an array.

```html
<div data-text="$foo.length"></div>
```

--------------------------------

### Stream SSE Events with C# and Datastar SDK

Source: https://data-star.dev/guide/backend_requests

This C# code example shows how to add Datastar as a service and use it to stream Server-Sent Events (SSE). It demonstrates patching elements into the DOM and sending signals asynchronously using `IDatastarService`. This requires the Datastar dependency injection setup.

```csharp
1using StarFederation.Datastar.DependencyInjection;
2
3// Adds Datastar as a service
4builder.Services.AddDatastar();
5
6app.MapGet("/", async (IDatastarService datastarService) =>
7{
8    // Patches elements into the DOM.
9    await datastarService.PatchElementsAsync(@"<div id=\"question\">What do you put in a toaster?</div>");
10
11    // Patches signals.
12    await datastarService.PatchSignalsAsync(new { response = "", answer = "bread" });
13});
```

--------------------------------

### Dynamically Update DOM Elements with SSE using Clojure SDK

Source: https://data-star.dev/guide/getting_started

This code snippet illustrates how to generate Server-Sent Events (SSE) using the Datastar Clojure SDK to patch elements into the DOM. It shows how to send an initial response and then update it after a delay.

```clojure
;; Import the SDK's api and your adapter
(require
 '[starfederation.datastar.clojure.api :as d*]
 '[starfederation.datastar.clojure.adapter.http-kit :refer [->sse-response on-open]])

;; in a ring handler
(defn handler [request]
 ;; Create an SSE response
 (->sse-response request
                 {on-open
                  (fn [sse]
                    ;; Patches elements into the DOM
                    (d*/patch-elements! sse
                                        "<div id=\"hal\">I‚Äôm sorry, Dave. I‚Äôm afraid I can‚Äôt do that.</div>")
                    (Thread/sleep 1000)
                    (d*/patch-elements! sse
                                        "<div id=\"hal\">Waiting for an order...</div>"))})
```