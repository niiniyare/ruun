{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "organisms/DataTableSchema",
  "title": "DataTable Organism Schema",
  "description": "Advanced data table with sorting, pagination, search, filtering, and bulk actions",
  "type": "object",
  "category": "organisms",
  "atomDependencies": [
    "ActionSchema",
    "IconSchema",
    "SpinnerSchema", 
    "CheckboxControlSchema",
    "TextControlSchema"
  ],
  "moleculeDependencies": [
    "SearchBoxSchema",
    "AlertSchema"
  ],
  "templateSupport": true,
  "htmxIntegration": true,
  "alpineIntegration": true,
  "properties": {
    "$$id": {
      "type": "string",
      "description": "Unique identifier for schema designer"
    },
    "$ref": {
      "type": "string",
      "description": "Reference to schema definition"
    },
    "type": {
      "type": "string",
      "const": "datatable",
      "description": "Component type identifier"
    },
    "id": {
      "type": "string",
      "description": "HTML element ID"
    },
    "className": {
      "type": "string", 
      "description": "Custom CSS classes"
    },
    "columns": {
      "type": "array",
      "minItems": 1,
      "description": "Table column definitions",
      "items": {
        "type": "object",
        "required": ["key", "label"],
        "properties": {
          "key": {
            "type": "string",
            "description": "Data property key"
          },
          "label": {
            "type": "string", 
            "description": "Column header label"
          },
          "sortable": {
            "type": "boolean",
            "default": true,
            "description": "Enable column sorting (uses ButtonSchema for sort controls)"
          },
          "searchable": {
            "type": "boolean",
            "default": true,
            "description": "Include in search functionality"
          },
          "hidden": {
            "type": "boolean",
            "default": false,
            "description": "Initially hidden column"
          },
          "width": {
            "type": "string",
            "description": "Column width CSS value"
          },
          "type": {
            "type": "string",
            "enum": ["text", "number", "date", "html", "boolean", "currency"],
            "default": "text",
            "description": "Data type for formatting"
          },
          "formatter": {
            "type": "string",
            "description": "Custom formatter function name"
          },
          "format": {
            "type": "string",
            "description": "Date/number format string"
          },
          "className": {
            "type": "string", 
            "description": "Column-specific CSS classes"
          },
          "align": {
            "type": "string",
            "enum": ["left", "center", "right"],
            "default": "left",
            "description": "Column text alignment"
          },
          "fixed": {
            "type": "boolean",
            "default": false,
            "description": "Fixed column position"
          },
          "resizable": {
            "type": "boolean",
            "default": true,
            "description": "Column can be resized"
          },
          "minWidth": {
            "type": "string",
            "description": "Minimum column width"
          },
          "maxWidth": {
            "type": "string", 
            "description": "Maximum column width"
          }
        }
      }
    },
    "data": {
      "type": "array",
      "description": "Static table data (optional if using server-side)",
      "items": {
        "type": "object",
        "description": "Row data object"
      }
    },
    "config": {
      "type": "object",
      "description": "DataTable configuration options",
      "properties": {
        "searchable": {
          "type": "boolean", 
          "default": true,
          "description": "Enable global search (uses SearchBoxSchema)"
        },
        "sortable": {
          "type": "boolean",
          "default": true,
          "description": "Enable column sorting"
        },
        "paging": {
          "type": "boolean",
          "default": true,
          "description": "Enable pagination (uses ButtonSchema for nav)"
        },
        "pageLength": {
          "type": "integer",
          "default": 25,
          "minimum": 5,
          "maximum": 100,
          "description": "Default rows per page"
        },
        "info": {
          "type": "boolean",
          "default": true,
          "description": "Show table information text"
        },
        "lengthChange": {
          "type": "boolean",
          "default": true,
          "description": "Allow changing page length"
        },
        "scrollY": {
          "type": "string",
          "description": "Vertical scroll height (e.g., '400px')"
        },
        "scrollX": {
          "type": "boolean",
          "default": false,
          "description": "Horizontal scroll"
        },
        "fixedHeader": {
          "type": "boolean",
          "default": false,
          "description": "Fixed header during scroll"
        },
        "fixedColumns": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of fixed columns"
        },
        "responsive": {
          "type": "boolean",
          "default": true,
          "description": "Responsive table behavior"
        },
        "autoWidth": {
          "type": "boolean",
          "default": true,
          "description": "Auto-calculate column widths"
        },
        "serverSide": {
          "type": "boolean",
          "default": false,
          "description": "Server-side processing mode"
        },
        "ajaxUrl": {
          "type": "string",
          "description": "AJAX endpoint for server-side data"
        },
        "deferRender": {
          "type": "boolean",
          "default": false,
          "description": "Defer rendering for performance"
        },
        "rowSelection": {
          "type": "boolean",
          "default": false,
          "description": "Enable row selection (uses CheckboxControlSchema)"
        },
        "multiSelect": {
          "type": "boolean",
          "default": true,
          "description": "Allow multiple row selection"
        },
        "selectOnClick": {
          "type": "boolean",
          "default": false,
          "description": "Select row on click"
        },
        "stateSave": {
          "type": "boolean",
          "default": false,
          "description": "Save table state"
        },
        "stateDuration": {
          "type": "integer",
          "default": 7200,
          "description": "State duration in seconds"
        }
      }
    },
    "actions": {
      "type": "array",
      "description": "Table-level actions (uses ButtonSchema)",
      "items": {
        "type": "object",
        "required": ["text"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Action button text"
          },
          "icon": {
            "type": "string",
            "description": "Action icon (references IconSchema)"
          },
          "variant": {
            "type": "string",
            "enum": ["primary", "secondary", "light", "dark", "red", "green", "yellow", "purple"],
            "default": "primary",
            "description": "Button variant (from ButtonSchema)"
          },
          "size": {
            "type": "string", 
            "enum": ["xs", "sm", "md", "lg", "xl"],
            "default": "sm",
            "description": "Button size"
          },
          "onclick": {
            "type": "string",
            "description": "Alpine.js click handler"
          },
          "hxPost": {
            "type": "string",
            "description": "HTMX POST endpoint"
          },
          "hxGet": {
            "type": "string",
            "description": "HTMX GET endpoint"
          },
          "hxDelete": {
            "type": "string",
            "description": "HTMX DELETE endpoint"
          },
          "hxTarget": {
            "type": "string",
            "description": "HTMX target selector"
          },
          "hxSwap": {
            "type": "string",
            "description": "HTMX swap strategy"
          },
          "hxConfirm": {
            "type": "string",
            "description": "HTMX confirmation message"
          },
          "showWhen": {
            "type": "string",
            "description": "Conditional display expression"
          },
          "position": {
            "type": "string",
            "enum": ["left", "right"],
            "default": "right",
            "description": "Action button position"
          },
          "tooltip": {
            "type": "string",
            "description": "Tooltip text"
          },
          "disabled": {
            "type": "boolean",
            "default": false,
            "description": "Disabled state"
          }
        }
      }
    },
    "bulkActions": {
      "type": "array",
      "description": "Actions available for selected rows (uses ButtonSchema)",
      "items": {
        "type": "object",
        "required": ["text"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Bulk action text"
          },
          "icon": {
            "type": "string",
            "description": "Action icon (references IconSchema)"
          },
          "variant": {
            "type": "string",
            "enum": ["primary", "secondary", "light", "dark", "red", "green", "yellow", "purple"],
            "default": "secondary",
            "description": "Button variant"
          },
          "onclick": {
            "type": "string",
            "description": "Alpine.js click handler with selected rows"
          },
          "hxPost": {
            "type": "string",
            "description": "HTMX POST endpoint for bulk operation"
          },
          "hxConfirm": {
            "type": "string",
            "description": "Confirmation message for bulk action"
          },
          "requiresSelection": {
            "type": "boolean",
            "default": true,
            "description": "Requires at least one selected row"
          },
          "dangerous": {
            "type": "boolean",
            "default": false,
            "description": "Mark as potentially destructive action"
          }
        }
      }
    },
    "rowActions": {
      "type": "array",
      "description": "Actions available for individual rows",
      "items": {
        "type": "object",
        "required": ["text"],
        "properties": {
          "text": {
            "type": "string",
            "description": "Row action text"
          },
          "icon": {
            "type": "string",
            "description": "Action icon (references IconSchema)"
          },
          "variant": {
            "type": "string",
            "enum": ["primary", "secondary", "light", "dark", "red", "green", "yellow", "purple"],
            "default": "light",
            "description": "Button variant"
          },
          "size": {
            "type": "string",
            "enum": ["xs", "sm", "md"],
            "default": "xs",
            "description": "Button size for row actions"
          },
          "onclick": {
            "type": "string",
            "description": "Alpine.js click handler with row data"
          },
          "hxPost": {
            "type": "string",
            "description": "HTMX POST endpoint"
          },
          "hxGet": {
            "type": "string",
            "description": "HTMX GET endpoint"
          },
          "hxDelete": {
            "type": "string",
            "description": "HTMX DELETE endpoint"
          },
          "hxTarget": {
            "type": "string",
            "description": "HTMX target selector"
          },
          "hxConfirm": {
            "type": "string",
            "description": "Confirmation message"
          },
          "showWhen": {
            "type": "string",
            "description": "Conditional display based on row data"
          }
        }
      }
    },
    "searchProps": {
      "type": "object",
      "description": "Search configuration (uses SearchBoxSchema)",
      "properties": {
        "placeholder": {
          "type": "string",
          "default": "Search table...",
          "description": "Search input placeholder"
        },
        "debounce": {
          "type": "integer",
          "default": 300,
          "description": "Search debounce delay in ms"
        },
        "minLength": {
          "type": "integer",
          "default": 0,
          "description": "Minimum characters before search"
        },
        "clearable": {
          "type": "boolean",
          "default": true,
          "description": "Show clear search button"
        }
      }
    },
    "showFilters": {
      "type": "boolean",
      "default": false,
      "description": "Display advanced filter panel"
    },
    "filterable": {
      "type": "boolean",
      "default": false,
      "description": "Enable filtering capability"
    },
    "dataUrl": {
      "type": "string",
      "description": "HTMX endpoint for table data"
    },
    "searchUrl": {
      "type": "string",
      "description": "HTMX endpoint for search operations"
    },
    "filterUrl": {
      "type": "string",
      "description": "HTMX endpoint for filtering operations"
    },
    "hxGet": {
      "type": "string",
      "description": "HTMX GET endpoint for table refresh"
    },
    "hxPost": {
      "type": "string",
      "description": "HTMX POST endpoint for table operations"
    },
    "hxTarget": {
      "type": "string",
      "description": "HTMX target element selector"
    },
    "hxSwap": {
      "type": "string",
      "description": "HTMX swap strategy"
    },
    "hxTrigger": {
      "type": "string",
      "description": "HTMX trigger events"
    },
    "styling": {
      "type": "object",
      "description": "Table styling options",
      "properties": {
        "striped": {
          "type": "boolean",
          "default": false,
          "description": "Alternating row colors"
        },
        "bordered": {
          "type": "boolean",
          "default": true,
          "description": "Table borders"
        },
        "hover": {
          "type": "boolean",
          "default": true,
          "description": "Row hover effects"
        },
        "compact": {
          "type": "boolean",
          "default": false,
          "description": "Reduce row height"
        },
        "variant": {
          "type": "string",
          "enum": ["default", "dark", "light"],
          "default": "default",
          "description": "Table color scheme"
        }
      }
    },
    "loading": {
      "type": "object",
      "description": "Loading state configuration",
      "properties": {
        "show": {
          "type": "boolean",
          "default": false,
          "description": "Show loading state (uses SpinnerSchema)"
        },
        "text": {
          "type": "string",
          "default": "Loading data...",
          "description": "Loading message"
        },
        "overlay": {
          "type": "boolean",
          "default": true,
          "description": "Show loading overlay"
        }
      }
    },
    "empty": {
      "type": "object",
      "description": "Empty state configuration",
      "properties": {
        "message": {
          "type": "string",
          "default": "No data available",
          "description": "Empty state message"
        },
        "icon": {
          "type": "string",
          "description": "Empty state icon (references IconSchema)"
        },
        "showCreateButton": {
          "type": "boolean",
          "default": false,
          "description": "Show create new item button"
        },
        "createText": {
          "type": "string",
          "default": "Create New",
          "description": "Create button text"
        },
        "createAction": {
          "type": "string",
          "description": "Create button action"
        }
      }
    },
    "caption": {
      "type": "string",
      "description": "Table caption for accessibility"
    },
    "summary": {
      "type": "string",
      "description": "Table summary for accessibility"
    },
    "title": {
      "type": "string",
      "description": "Table title"
    },
    "description": {
      "type": "string",
      "description": "Table description"
    },
    "ariaLabel": {
      "type": "string",
      "description": "ARIA label for table"
    },
    "dataTestId": {
      "type": "string",
      "description": "Test automation identifier"
    },
    "variant": {
      "type": "string",
      "enum": ["default", "outlined", "filled", "ghost"],
      "default": "default",
      "description": "Table style variant"
    },
    "size": {
      "type": "string",
      "enum": ["xs", "sm", "md", "lg", "xl"],
      "default": "md",
      "description": "Table size"
    },
    "onRowClick": {
      "type": "string",
      "description": "Row click handler"
    },
    "onRowSelect": {
      "type": "string",
      "description": "Row selection handler"
    },
    "onSort": {
      "type": "string",
      "description": "Sort handler"
    },
    "onFilter": {
      "type": "string",
      "description": "Filter handler"
    },
    "onPageChange": {
      "type": "string",
      "description": "Page change handler"
    },
    "hidden": {
      "type": "boolean",
      "default": false,
      "description": "Hidden state"
    },
    "hiddenOn": {
      "$ref": "#/definitions/SchemaExpression",
      "description": "Dynamic hidden condition"
    },
    "visible": {
      "type": "boolean",
      "default": true,
      "description": "Visible state"
    },
    "visibleOn": {
      "$ref": "#/definitions/SchemaExpression",
      "description": "Dynamic visible condition"
    },
    "disabled": {
      "type": "boolean",
      "default": false,
      "description": "Disabled state"
    },
    "disabledOn": {
      "$ref": "#/definitions/SchemaExpression",
      "description": "Dynamic disabled condition"
    },
    "onEvent": {
      "$ref": "#/definitions/EventConfiguration",
      "description": "Event listeners configuration"
    },
    "editorSetting": {
      "$ref": "#/definitions/EditorSetting",
      "description": "Visual editor configuration"
    },
    "static": {
      "type": "boolean",
      "default": false,
      "description": "Static display mode"
    },
    "staticOn": {
      "$ref": "#/definitions/SchemaExpression",
      "description": "Dynamic static condition"
    },
    "staticPlaceholder": {
      "type": "string",
      "description": "Static mode placeholder"
    },
    "staticClassName": {
      "type": "string",
      "description": "Static mode CSS classes"
    },
    "useMobileUI": {
      "type": "boolean",
      "description": "Enable mobile UI optimization"
    }
  },
  "required": [
    "type",
    "columns"
  ],
  "definitions": {
    "SchemaExpression": {
      "type": "object",
      "properties": {
        "static": {
          "type": "boolean",
          "description": "Static boolean value"
        },
        "expression": {
          "type": "string",
          "description": "Dynamic expression string"
        }
      }
    },
    "EventConfiguration": {
      "type": "object",
      "patternProperties": {
        "^[a-zA-Z][a-zA-Z0-9]*$": {
          "type": "object",
          "properties": {
            "weight": {
              "type": "integer",
              "description": "Event listener priority"
            },
            "actions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "actionType": {
                    "type": "string"
                  },
                  "args": {
                    "type": "object"
                  }
                }
              }
            }
          }
        }
      }
    },
    "EditorSetting": {
      "type": "object",
      "properties": {
        "behavior": {
          "type": "string",
          "enum": ["create", "update", "remove"]
        },
        "displayName": {
          "type": "string"
        },
        "mock": {
          "description": "Mock data for editor preview"
        }
      }
    }
  },
  "examples": [
    {
      "name": "Basic Data Table",
      "description": "Simple table with sorting and pagination",
      "data": {
        "type": "datatable",
        "id": "users-table",
        "columns": [
          {
            "key": "name",
            "label": "Name",
            "sortable": true,
            "searchable": true
          },
          {
            "key": "email", 
            "label": "Email",
            "sortable": true,
            "searchable": true,
            "type": "text"
          },
          {
            "key": "created_at",
            "label": "Created",
            "sortable": true,
            "type": "date",
            "format": "MMM DD, YYYY"
          }
        ],
        "config": {
          "searchable": true,
          "paging": true,
          "pageLength": 25
        },
        "actions": [
          {
            "text": "Add User",
            "icon": "user-plus",
            "variant": "primary",
            "onclick": "openCreateModal()"
          }
        ]
      }
    },
    {
      "name": "Server-Side Table with Bulk Actions",
      "description": "HTMX-powered table with bulk operations",
      "data": {
        "type": "datatable",
        "id": "orders-table",
        "config": {
          "serverSide": true,
          "rowSelection": true,
          "ajaxUrl": "/api/orders/datatable"
        },
        "columns": [
          {
            "key": "order_number",
            "label": "Order #"
          },
          {
            "key": "customer",
            "label": "Customer"
          },
          {
            "key": "total",
            "label": "Total",
            "type": "currency"
          },
          {
            "key": "status",
            "label": "Status"
          }
        ],
        "bulkActions": [
          {
            "text": "Export Selected",
            "icon": "download",
            "variant": "secondary",
            "hxPost": "/api/orders/export"
          },
          {
            "text": "Delete Selected",
            "icon": "trash",
            "variant": "red",
            "hxPost": "/api/orders/bulk-delete",
            "hxConfirm": "Delete selected orders?",
            "dangerous": true
          }
        ]
      }
    }
  ],
  "integrationNotes": {
    "atoms": {
      "Action": "Used for actions, sorting controls, pagination navigation",
      "Icon": "Used for action icons, sort indicators, empty state icons",
      "Spinner": "Used for loading states during data operations",
      "CheckboxControl": "Used for row selection when rowSelection is enabled",
      "TextControl": "Used in search functionality and filter inputs"
    },
    "molecules": {
      "SearchBox": "Used for global table search when searchable is true",
      "Alert": "Used for error states and bulk action confirmations"
    },
    "htmx": {
      "serverSide": "Full server-side processing with AJAX endpoints",
      "actions": "Row and bulk actions submitted via HTMX",
      "filtering": "Dynamic filtering with server updates",
      "sorting": "Server-side sorting with HTMX requests"
    },
    "alpine": {
      "rowSelection": "Manages selected rows state",
      "bulkActions": "Enables/disables based on selection",
      "filtering": "Manages filter panel state",
      "sorting": "Manages sort state and indicators"
    },
    "dataTables": {
      "integration": "Uses DataTables.js for advanced table functionality",
      "responsive": "Automatic responsive column management",
      "search": "Enhanced search with highlighting",
      "export": "Built-in export functionality"
    }
  }
}